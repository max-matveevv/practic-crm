# Ð§ÐµÐº-Ð»Ð¸ÑÑ‚ Ð´Ð»Ñ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ð³Ð¾ Ð´ÐµÐ¿Ð»Ð¾Ñ

## âœ… Ð“Ð¾Ñ‚Ð¾Ð²Ð¾ Ðº Ð´ÐµÐ¿Ð»Ð¾ÑŽ

### Backend Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ:
- âœ… ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½ `config/sanctum.php` - Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ñ‹ stateful domains
- âœ… ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½ `config/session.php` - Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð´Ð»Ñ HTTPS
- âœ… ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½ `config/cors.php` - Ð´Ð¾Ð¼ÐµÐ½ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½ Ð² allowed origins
- âœ… Ð£Ð±Ñ€Ð°Ð½Ñ‹ Ð¾Ñ‚Ð»Ð°Ð´Ð¾Ñ‡Ð½Ñ‹Ðµ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»Ð»ÐµÑ€Ñ‹ Ð¸ Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚Ñ‹

### Frontend Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ:
- âœ… Ð˜ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ñ‹ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Ð»Ð¸Ð½Ñ‚ÐµÑ€Ð° (prefer-const, unused-vars)
- âœ… Ð£Ð±Ñ€Ð°Ð½ Ð¾Ñ‚Ð»Ð°Ð´Ð¾Ñ‡Ð½Ñ‹Ð¹ ÐºÐ¾Ð´ Ð¸Ð· `auth.ts`
- âœ… Ð£Ð»ÑƒÑ‡ÑˆÐµÐ½Ð° Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° CSRF Ñ‚Ð¾ÐºÐµÐ½Ð¾Ð²

### Ð¤Ð°Ð¹Ð»Ñ‹ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸:
- âœ… `deploy/production.env.example` - Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð´Ð°ÐºÑˆÐµÐ½Ð°
- âœ… `deploy/frontend.env.production.example` - Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ñ„Ñ€Ð¾Ð½Ñ‚ÐµÐ½Ð´Ð°
- âœ… `deploy/CSRF_FIX_PRODUCTION.md` - Ð¸Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸Ñ Ð¿Ð¾ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸ÑŽ CSRF
- âœ… `deploy/DEBUG_419_ERROR.md` - Ð¾Ñ‚Ð»Ð°Ð´ÐºÐ° Ð¾ÑˆÐ¸Ð±ÐºÐ¸ 419

## ðŸš€ Ð§Ñ‚Ð¾ Ð¿Ñ€Ð¾Ð¸Ð·Ð¾Ð¹Ð´ÐµÑ‚ Ð¿Ñ€Ð¸ Ð´ÐµÐ¿Ð»Ð¾Ðµ:

### ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸:
1. ÐšÐ¾Ð´ Ð¾Ð±Ð½Ð¾Ð²Ð¸Ñ‚ÑÑ Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€Ðµ
2. Ð—Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÑÑ‚ÑÑ (composer install, npm install)
3. ÐŸÑ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð¿ÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑÑ

### ÐÑƒÐ¶Ð½Ð¾ ÑÐ´ÐµÐ»Ð°Ñ‚ÑŒ Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€Ðµ:

#### 1. ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ .env Ñ„Ð°Ð¹Ð»:
```bash
# Ð¡ÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð¸Ð· production.env.example
cp deploy/production.env.example .env

# Ð˜Ð»Ð¸ Ð¾Ð±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ð¹ .env:
SESSION_SAME_SITE=lax
SESSION_SECURE_COOKIE=true
SESSION_PARTITIONED_COOKIE=true
SESSION_DOMAIN=crm.practic.studio
SANCTUM_STATEFUL_DOMAINS=crm.practic.studio
```

#### 2. ÐžÑ‡Ð¸ÑÑ‚Ð¸Ñ‚ÑŒ Ð¸ Ð¿ÐµÑ€ÐµÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ ÐºÑÑˆ:
```bash
php artisan config:clear
php artisan config:cache
php artisan route:cache
```

#### 3. Ð’Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑŒ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸ (ÐµÑÐ»Ð¸ ÐµÑÑ‚ÑŒ Ð½Ð¾Ð²Ñ‹Ðµ):
```bash
php artisan migrate
```

#### 4. ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ñ„Ñ€Ð¾Ð½Ñ‚ÐµÐ½Ð´ .env.local:
```bash
# ÐÐ° Ñ„Ñ€Ð¾Ð½Ñ‚ÐµÐ½Ð´Ðµ
NEXT_PUBLIC_API_URL=https://crm.practic.studio/api
```

## ðŸ” ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¿Ð¾ÑÐ»Ðµ Ð´ÐµÐ¿Ð»Ð¾Ñ:

1. **ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ ÑÐ°Ð¹Ñ‚** - Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð·Ð°Ð³Ñ€ÑƒÐ¶Ð°Ñ‚ÑŒÑÑ Ð±ÐµÐ· Ð¾ÑˆÐ¸Ð±Ð¾Ðº
2. **ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸ÑŽ** - CSRF Ð¾ÑˆÐ¸Ð±ÐºÐ° Ð´Ð¾Ð»Ð¶Ð½Ð° Ð¸ÑÑ‡ÐµÐ·Ð½ÑƒÑ‚ÑŒ
3. **ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ DevTools**:
   - Network â†’ Ð·Ð°Ð¿Ñ€Ð¾Ñ Ðº `/sanctum/csrf-cookie` Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°Ñ‚ÑŒ 200
   - Application â†’ Cookies â†’ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ `XSRF-TOKEN`
   - Network â†’ Ð·Ð°Ð¿Ñ€Ð¾Ñ Ðº `/api/auth/register` Ð´Ð¾Ð»Ð¶ÐµÐ½ ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ `X-XSRF-TOKEN` Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº

## ðŸ†˜ Ð•ÑÐ»Ð¸ Ñ‡Ñ‚Ð¾-Ñ‚Ð¾ Ð½Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚:

1. **ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð»Ð¾Ð³Ð¸**: `tail -f storage/logs/laravel.log`
2. **ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸ÑŽ**: `php artisan config:show session`
3. **ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ð°Ð»ÑŒÑ‚ÐµÑ€Ð½Ð°Ñ‚Ð¸Ð²Ð½Ñ‹Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸** Ð¸Ð· `DEBUG_419_ERROR.md`

## ðŸ“ ÐšÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Ð´Ð»Ñ Ð±Ñ‹ÑÑ‚Ñ€Ð¾Ð¹ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸:

```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ñ‚ÐµÐºÑƒÑ‰Ð¸Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ ÑÐµÑÑÐ¸Ð¸
php artisan tinker
>>> config('session.same_site')
>>> config('session.secure')
>>> config('session.domain')

# ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Sanctum Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸
>>> config('sanctum.stateful')
```

---

**Ð“Ð¾Ñ‚Ð¾Ð²Ð¾ Ðº Ð´ÐµÐ¿Ð»Ð¾ÑŽ! ðŸŽ‰**
